window.Eurus.loadedScript.includes("coupon-code.js")||(window.Eurus.loadedScript.push("coupon-code.js"),requestAnimationFrame((()=>{document.addEventListener("alpine:init",(()=>{Alpine.data("xCounponCodeList",(e=>({loading:!0,load(){this.loading=!0;let t=`${window.location.pathname}?section_id=${e}`;fetch(t,{method:"GET"}).then((e=>e.text())).then((t=>{const o=(new DOMParser).parseFromString(t,"text/html"),i=`x-promo-code-list-${e}`,n=o.getElementById(i);n&&!document.getElementById(i)&&container.appendChild(n),this.loading=!1}))}}))),Alpine.data("xCounponCode",(()=>({coppySuccess:!1,loading:!1,disableCoupon:!1,disableComing:!1,discountCode:"",errorMessage:!1,appliedDiscountCode:!1,load(e){this.setAppliedButton(e),document.addEventListener("eurus:cart:discount-code:change",(t=>{this.setAppliedButton(e)}))},copyCode(){if(this.coppySuccess)return;const e=this.$refs.code_value.textContent.trim();navigator.clipboard.writeText(e).then((()=>{this.coppySuccess=!0,setTimeout((()=>{this.coppySuccess=!1}),5e3)}),(()=>{alert("Copy fail")}))},applyCouponCode(e,t=!1){let o=JSON.parse(JSON.stringify(Alpine.store("xCounponCodeDetail").appliedDiscountCodes));if(e&&-1!=o.indexOf(e))return!0;if(e){let i=o.length>0?[...o,e].join(","):e;document.cookie=`eurus_discount_code=${i}; path=/`,this.loading=!0,fetch(`/checkout?discount=${i}`).then((()=>{fetch("/cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sections:Alpine.store("xCartHelper").getSectionsToRender().map((e=>e.id))})}).then((e=>e.json())).then((o=>{if("422"!=o.status&&(Alpine.store("xCartHelper").getSectionsToRender().forEach((e=>{const t=document.querySelector(e.selector);t&&o.sections[e.id]&&(t.innerHTML=getSectionInnerHTML(o.sections[e.id],e.selector))})),Alpine.store("xCounponCodeDetail").appliedDiscountCodes.push(e),Alpine.store("xCartHelper").currentItemCount=parseInt(document.querySelector("#cart-icon-bubble span").innerHTML),document.dispatchEvent(new CustomEvent("eurus:cart:discount-code:change")),0==t))if(this.setAppliedButton(e),0==Alpine.store("xCartHelper").currentItemCount){const e=this.$el.closest(".promo-code-item").querySelector(".error-message");this.errorMessage=!0,e.classList.remove("hidden","opacity-0"),e.classList.add("block","opacity-100"),setTimeout((function(){e.classList.remove("block","opacity-100"),e.classList.add("hidden","opacity-0")}),3e3)}else this.errorMessage=!1,Alpine.store("xMiniCart").openCart()})).finally((()=>{this.loading=!1}))})).catch((function(e){console.error("Error:",e)}))}},handleScheduleCoupon(e){let t=xParseJSON(e.getAttribute("x-countdown-data")),o=Alpine.store("xHelper").handleTime(t);o.distance<0&&t.set_end_date?this.disableCoupon=!0:o.startTime>o.now&&(this.disableCoupon=!0,this.disableComing=!0)},onChange(){this.discountCode=this.$el.value},applyDiscountToCart(){this.applyCouponCode(this.discountCode,!0)},setAppliedButton(e){let t=JSON.parse(JSON.stringify(Alpine.store("xCounponCodeDetail").appliedDiscountCodes));e&&-1!=t.indexOf(e)?this.appliedDiscountCode=!0:this.appliedDiscountCode=!1}}))),Alpine.store("xCounponCodeDetail",{show:!1,promoCodeDetail:{},sectionID:"",discountCodeApplied:"",appliedDiscountCodes:[],cachedResults:[],loading:!1,cartEmpty:!0,handleCouponSelect(e){var t=this;const o=JSON.parse(JSON.stringify(this.promoCodeDetail));if(document.addEventListener("shopify:section:select",(function(e){0==e.target.classList.contains("section-promo-code")&&(window.Alpine?t.close():document.addEventListener("alpine:initialized",(()=>{t.close()})))})),o&&o.blockID&&o.sectionID){this.promoCodeDetail=xParseJSON(document.getElementById("x-data-promocode-"+o.blockID).getAttribute("x-data-promocode"));let t=document.getElementById("PromoCodeContent-"+this.promoCodeDetail.sectionID);if(this.cachedResults[this.promoCodeDetail.blockID])return t.innerHTML=this.cachedResults[this.promoCodeDetail.blockID],!0;if(""!=this.promoCodeDetail.page){let o=`${e}/pages/${this.promoCodeDetail.page}`;fetch(o,{method:"GET"}).then((e=>e.text())).then((e=>{const o=(new DOMParser).parseFromString(e,"text/html");t.innerHTML=o.querySelector(".page__container .page__body").innerHTML}))}else""!=this.promoCodeDetail.details&&(t.innerHTML=this.promoCodeDetail.details,t.innerHTML=t.textContent)}},load(e,t,o){this.promoCodeDetail=xParseJSON(e.closest("#x-data-promocode-"+t).getAttribute("x-data-promocode"));let i=document.getElementById("PromoCodeContent-"+this.promoCodeDetail.sectionID);if(this.sectionID=this.promoCodeDetail.sectionID,this.cachedResults[t])return i.innerHTML=this.cachedResults[t],!0;if(""!=this.promoCodeDetail.page){this.loading=!0;let e=`${o}/pages/${this.promoCodeDetail.page}`;fetch(e,{method:"GET"}).then((e=>e.text())).then((e=>{const o=(new DOMParser).parseFromString(e,"text/html").querySelector(".page__container .page__body").innerHTML;i.innerHTML=o,this.cachedResults[t]=o})).finally((()=>{this.loading=!1}))}else""!=this.promoCodeDetail.details&&(i.innerHTML=this.promoCodeDetail.details,i.innerHTML=i.textContent)},showPromoCodeDetail(){this.show=!0,Alpine.store("xPopup").open=!0},close(){this.show=!1,Alpine.store("xPopup").open=!1},getDiscountCode(){let e=document.cookie.match("(^|;)\\s*eurus_discount_code\\s*=\\s*([^;]+)"),t=e?e.pop():"";t&&(this.appliedDiscountCodes=t.split(","))}})}))})));
