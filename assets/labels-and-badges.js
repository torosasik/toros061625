requestAnimationFrame((()=>{document.addEventListener("alpine:init",(()=>{Alpine.store("xBadges",{fixedPositionTemplate:'<div\n        class="x-badge-{label-id} x-badge-container pointer-events-none{container-img-class} ltr"\n        {preview-show-condition}\n      >\n        {content}\n      </div>',customPositionTemplate:"<div\n        class=\"x-badge-{label-id} x-badge-container min-w-fit max-w-full max-h-full pointer-events-none{container-css-class} ltr\"\n        x-data=\"{\n          contentHeight: 1,\n          rePosition() {\n            this.$nextTick(() => {\n              this.contentHeight = this.$refs.content ? this.$refs.content.offsetHeight : contentHeight;\n            });\n          }\n        }\"\n        x-intersect.once=\"rePosition();\n          if (Shopify.designMode) {\n            window.addEventListener('resize', () => {\n              if ($store.xBadges.lastWindowWidth != window.innerWidth) {\n                rePosition();\n              }\n            });\n          } else {\n            installMediaQueryWatcher('(min-width: 768px)', (matches) => rePosition());\n          }\"\n        {preview-show-condition}\n        :style=\"'{css-position} min-height: ' + contentHeight + 'px'\"\n      >\n        {content}\n      </div>",productDetailTemplate:'<div\n        class="x-badge-{label-id} x-badge-container min-w-fit max-w-full max-h-full bottom-0 pointer-events-none{container-css-class}{container-img-class}"\n      >\n        {content}\n      </div>',previewActiveBlock:window.xBadgesPreviewActiveBlock,init(){Shopify.designMode&&document.addEventListener("shopify:block:select",(e=>{if(!e.target.classList.contains("x-badges-block-preview"))return;let t=xParseJSON(e.target.getAttribute("data-shopify-editor-block"));this.previewActiveBlock=t.id,window.xBadgesPreviewActiveBlock=t.id,document.dispatchEvent(new CustomEvent("eurus:badges:block-select"))}))},load(e,t=(()=>{}),n=null){n&&(e.container=n);const i=e.closest("[x-data-slider]");if(i)if(i.classList.contains("is-initialized"))this.doLoad(e,t);else{const n=e.closest("[x-data-slider]").getAttribute("x-data-slider");document.addEventListener(`eurus:${n}:splide-ready`,(()=>{this.doLoad(e,t)}))}else this.doLoad(e,t)},doLoad(e,t=(()=>{})){if(this.initAllLabels(e),Shopify.designMode){let t=xParseJSON(e.getAttribute("x-labels-data"));document.addEventListener("shopify:section:load",(()=>{t&&!t.isXBadgesPreview&&this.initAllLabels(e)}))}t(e)},initAllLabels(e){let t=xParseJSON(e.getAttribute("x-labels-data"));if(!t)return;if(Shopify.designMode){let t=e.getElementsByClassName("x-badge-container");if(t.length>0){const e=t.length;for(let n=0;n<e;n++)t[0].remove()}}let n=document.getElementsByClassName("x-badges-block-data");for(let i=0;i<n.length;i++){let s=xParseJSON(n[i].getAttribute("x-badges-block-data"));if(!s.enable&&!t.isXBadgesPreview)return;s.settings.icon=n[i].getAttribute("x-badges-icon"),this.appendLabel(e,s,t)}e.removeAttribute("x-labels-data")},appendLabel(e,t,n){if("product-info"==n.container||"custom"==t.settings.position)return void(e.innerHTML+=this.processTemplate(e,t,n));let i=e.querySelector(`.${t.settings.position}-container`);i||(i=this.createFixedPositionContainer(t.settings.position),e.appendChild(i)),i.innerHTML+=this.processTemplate(e,t,n)},createFixedPositionContainer(e){let t=`${e}-container label-container absolute gap-1 space-y-1`;return t+=e.includes("top")?" top-1 flex-col":" bottom-1 flex-col-reverse",t+=e.includes("left")?" left-1":" right-1",container=document.createElement("div"),container.setAttribute("class",t),container},processContent(e,t,n){let i=!1;const s=this.canShow(t,n);if(t.settings.image&&s){let e,s,l;if("product-info"==n.container?(e=126,s=Math.round(e*t.settings.image_aspect_ratio)):(s=15*t.settings.size,e=s/t.settings.image_aspect_ratio),l=t.settings.image.src?t.settings.image.src.includes("burst.shopifycdn.com")?t.settings.image.src:t.settings.image.src+"&width="+3*s:t.settings.image.includes("burst.shopifycdn.com")?t.settings.image:t.settings.image+"&width="+3*s,"card"==n.container)var o=t.settings.horizontal_position>50?"justify-end":"justify-start",a="width: var(--width-image-label); height: var(--height-image-label)";else o=n.make_content_center?"justify-center":"justify-start",a="";i=`<div x-ref="content" class='x-badge-content flex ${o}{css-opacity}'>\n            <img \n              loading="lazy"\n              width="`+s+'"\n              height="'+e+'"\n              alt="'+(t.settings.image_alt.length>0?t.settings.image_alt:n.title)+'"\n              src="'+l+`"\n              style="${a}"\n            />\n          </div>`}else if(t.settings.content&&s){let s=n.inventory_management.length<1||n.qty<0?"":n.qty,o=n.sale_amount.includes("-")?"":n.sale_amount,a=t.settings.schedule_enabled?'<span x-intersect.once="$nextTick(() => { if (typeof rePosition !== `undefined`) {rePosition()} });" class="x-badge-countdown-'+t.id+' label-countdown empty:hidden"></span>':"",l=Math.round(100*(n.compare_at_price-n.price)/n.compare_at_price);l=l>0?l+"%":"",i=t.settings.content.replace(/{sale}/gi,l).replace(/{sale_amount}/gi,o).replace(/{qty}/gi,s).replace(/{price}/gi,n.price_with_currency).replace(/{count_down}/gi,a);const r=t.settings.size/2,c=t.settings.size_mobile/2,d="product-info"==n.container?"":` pt-${c} pb-${c} pl-${c+1.5} pr-${c+1.5} md:pt-${r} md:pb-${r} md:pl-${r+1.5} md:pr-${r+1.5}`,g="product-info"==n.container?"":'style="font-size: var(--font-size-scale);"',p="product-info"==n.container?"":'style="height: var(--font-size-scale); width: var(--font-size-scale); min-width: var(--font-size-scale);"';i=i.length>0&&`<div\n                x-ref="content"\n                class='x-badge-content ltr x-badge-text select-none inline-flex justify-center${d} items-center{css-opacity}{css-type} gap-2'\n                ${g}\n              ><span class="icon-label empty:hidden" ${p}>${t.settings.icon}</span><span class="leading-normal w-fit p-break-words">${i}</span></div>`,a.length>0&&t.settings.schedule_enabled&&Alpine.store("xHelper").countdown(t.settings,(function(n,i,s,o,a){const l=(e.container?e.container:e).getElementsByClassName("x-badge-countdown-"+t.id);if(!n){for(let e=0;e<l.length;e++)l[e].innerHTML="";return}const r=(a=a>0?a+"D&nbsp;&nbsp;&nbsp;":"")+(o=0==o&&0==a.length?"":o+" : ")+s+" : "+i;for(let e=0;e<l.length;e++)l[e].innerHTML=r}))}return i},processTemplate(e,t,n){let i="";if(content=this.processContent(e,t,n)){const e=" opacity-"+t.settings.opacity,s="card"==n.container?"left: "+t.settings.horizontal_position+"%; transform: translate(-"+t.settings.horizontal_position+"%, -"+t.settings.vertical_position+"%); top: "+t.settings.vertical_position+"%;":"";let o="";"round"==t.settings.type&&(o=" rounded-md"),"rounded-full"==t.settings.type&&(o=" rounded-full");let a="card"==n.container?" absolute w-max":"";a+=t.settings.horizontal_position>50?" text-end":" text-start";const l=n.isXBadgesPreview?"x-show=\"$store.xBadges.previewActiveBlock == '{label-id}'\"":"",r=t.settings.image?" label-img":"";i=this.getLableTemplate(n.container,t.settings.position),i=i.replace("{preview-show-condition}",l).replace("{content}",content).replace("{css-opacity}",e).replace("{css-position}",s).replace("{css-type}",o).replace("{container-css-class}",a).replace("{container-img-class}",r).replace(/{label-id}/gi,t.id)}return i},getLableTemplate(e,t){return"product-info"==e?this.productDetailTemplate:"custom"==t?this.customPositionTemplate:this.fixedPositionTemplate},canShow(e,t){if(t.isXBadgesPreview)return!0;if("card"==t.container&&!e.settings.show_on_product_card)return!1;if("product-info"==t.container&&!e.settings.show_on_product_page)return!1;if("sale-label"==e.type&&t.compare_at_price>t.price)return!0;if("sold-out-label"==e.type&&!t.available)return!0;if(e.settings.schedule_enabled){let t=new Date(e.settings.end_year,e.settings.end_month-1,e.settings.end_day,e.settings.end_hour,e.settings.end_minute);e.endTime=t.getTime()+60*(-1*e.settings.timezone*60-t.getTimezoneOffset())*1e3;let n=new Date(e.settings.start_year,e.settings.start_month-1,e.settings.start_day,e.settings.start_hour,e.settings.start_minute);e.startTime=n.getTime()+60*(-1*e.settings.timezone*60-n.getTimezoneOffset())*1e3;let i=(new Date).getTime();if(e.endTime<i)return!1;if(e.startTime>i)return!1}if(e.settings.applied_products.includes(t.id))return!0;for(let n=0;n<e.settings.applied_collections.length;n++)if(t.collections.includes(e.settings.applied_collections[n]))return!0;return"sale-label"!=e.type&&"sold-out-label"!=e.type&&0==e.settings.applied_products.length&&0==e.settings.applied_collections.length}})}))}));
