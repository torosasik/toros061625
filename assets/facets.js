document.addEventListener("alpine:init",(()=>{Alpine.data("xFiltersAndSortby",(e=>({t:"",show:!1,showFilterAside:!0,loading:!1,isDesktop:!1,listLayout:!1,cachedResults:[],searchParamsPrev:window.location.search.slice(1),searchParamsInitial:window.location.search.slice(1),init(){"list"==localStorage.getItem("list-layout")&&(this.listLayout=!0),this._initLayout(),this._setListeners()},_initLayout(){let e=document.getElementsByClassName("form-aside")[0],t=document.getElementsByClassName("form-drawer")[0];window.innerWidth>767?(this.isDesktop=!0,e?(e.setAttribute("id","FacetFiltersForm"),t&&t.removeAttribute("id")):t&&t.setAttribute("id","FacetFiltersForm")):(this.isDesktop=!1,e&&e.removeAttribute("id"),t&&t.setAttribute("id","FacetFiltersForm"))},_setListeners(){window.addEventListener("popstate",(e=>{const t=e.state?e.state.searchParams:this.searchParamsInitial;t!==this.searchParamsPrev&&this._renderPage(t,!1)})),installMediaQueryWatcher("(min-width: 768px)",this._initLayout)},toggleLayout(e){this.listLayout=e,localStorage.setItem("list-layout",e?"list":"grid"),window.dispatchEvent(new Event("resize"))},removeFilter(e){this._reloadFilter(e)},renderPagination(){var e={attributes:{"collection-pagination":this.$el.value}};fetch(Shopify.routes.root+"cart/update",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)}).then((()=>{this.cachedResults=[];const e=this._createSearchParams(document.getElementById("FacetFiltersForm"));this._renderPage(e)}))},onSubmit(e=500){clearTimeout(this.t);const t=()=>{const e=this._createSearchParams(document.getElementById("FacetFiltersForm"));this._renderPage(e),this.isDesktop&&document.getElementById("FormSelectFilter").blur()};this.t=setTimeout((()=>{t()}),e)},rangePrice(e){const t=e.querySelectorAll(".range-input input"),r=e.querySelectorAll(".price-input"),n=e.querySelectorAll(".price-preview"),s=e.querySelector(".slider .progress");t.forEach((e=>{e.addEventListener("input",(e=>{e.preventDefault();let i=parseInt(t[0].value),a=parseInt(t[1].value);a-i<1?"range-min"===e.target.className?(t[0].value=a-1,r[0].value=a-1):(t[1].value=i+1,r[1].value=a+1):(r[0].value=i,r[1].value=a,s.style.setProperty("--left_range",i/t[0].max*100+"%"),s.style.setProperty("--right_range",100-a/t[1].max*100+"%")),n[0].textContent=i,n[1].textContent=a}))}))},initRange(e){const t=e.querySelectorAll(".range-input input"),r=e.querySelector(".slider .progress");let n=parseInt(t[0].value),s=parseInt(t[1].value);r.style.setProperty("--left_range",n/t[0].max*100+"%"),r.style.setProperty("--right_range",100-s/t[1].max*100+"%")},_reloadFilter(e){const t=-1==e.indexOf("?")?"":e.slice(e.indexOf("?")+1);this._renderPage(t)},_createSearchParams(e){const t=new FormData(e);return new URLSearchParams(t).toString()},_updateURLHash(e){history.pushState({searchParams:e},"",`${window.location.pathname}${e&&"?".concat(e)}`)},_renderPage(t,r=!0){if(this.searchParamsPrev=t,this.loading=!0,this.cachedResults[t])return void this._renderResults(this.cachedResults[t]);const n=`${window.location.pathname}?section_id=${e}&${t}`;fetch(n).then((e=>e.text())).then((e=>{const r=e;this.cachedResults[t]=r,this._renderResults(r)})),r&&this._updateURLHash(t)},_renderResults(e){this._renderFilters(e),this._renderProductGridContainer(e),this._renderProductCount(e),this.loading=!1},_renderFilters(e){const t=(new DOMParser).parseFromString(e,"text/html"),r=t.querySelectorAll(".js-filter");document.querySelectorAll(".js-filter").forEach((e=>{e.innerHTML=""})),Array.from(r).forEach((e=>{document.querySelector(`.js-filter[data-index="${e.dataset.index}"]`).innerHTML=e.innerHTML})),this._renderActiveFacets(t),this._renderAdditionalElements(t)},_renderProductGridContainer(e){document.getElementById("ProductGridContainer").innerHTML=(new DOMParser).parseFromString(e,"text/html").getElementById("ProductGridContainer").innerHTML},_renderProductCount(e){const t=(new DOMParser).parseFromString(e,"text/html").getElementById("ProductCount");if(t){const e=t.innerHTML,r=document.getElementById("ProductCount_header"),n=document.getElementById("ProductCountDrawer");r&&(r.innerHTML=e),n&&(n.innerHTML=e),r.classList.remove("loading")}},_renderActiveFacets(e){const t=document.getElementById("active-filter-tag"),r=document.getElementById("active-filter-tag-mobile");t&&(t.innerHTML=e.getElementById("active-filter-tag").innerHTML),r&&(r.innerHTML=e.getElementById("active-filter-tag-mobile").innerHTML)},_renderAdditionalElements(e){const t=document.getElementById("ProductPerPage");t&&(t.innerHTML=e.getElementById("ProductPerPage").innerHTML)},_renderCounts(e,t){const r=t.querySelector(".facets__selected"),n=e.querySelector(".facets__selected"),s=t.querySelector(".facets__summary"),i=e.querySelector(".facets__summary");n&&r&&(t.querySelector(".facets__selected").outerHTML=e.querySelector(".facets__selected").outerHTML),s&&i&&(t.querySelector(".facets__summary").outerHTML=e.querySelector(".facets__summary").outerHTML)},_filterFocus(){Alpine.store("xFocusElement").trapFocus("ProductFilter","CloseFilter")},_filterRemoveFocus(){const e=document.getElementById("btn-filter");Alpine.store("xFocusElement").removeTrapFocus(e)},setFilterHeaderHeight(){document.documentElement.style.setProperty("--height-sticky-filter",document.getElementById("FacetsWrapperDesktop").offsetHeight+"px")},setPositionOptionFilter(e){elRect=e.getBoundingClientRect();const t=e.getElementsByClassName("popup-above")[0];let r=window.innerWidth-elRect.left-320;t.style.left=r>=0?"0px":r+"px"}})))}));
