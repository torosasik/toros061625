window.Eurus.loadedScript.includes("product-bundle.js")||(window.Eurus.loadedScript.push("product-bundle.js"),requestAnimationFrame((()=>{document.addEventListener("alpine:init",(()=>{Alpine.data("xProductBundle",((t,e,i,r,a,d)=>({products:"",productsBundle:[],loading:!1,addToCartButton:"",totalPrice:0,errorMessage:!1,showBundleContent:!1,totalDiscount:0,amountPrice:0,init(){this.addToCartButton=this.$el.querySelector(".button-atc")},addToBundle(t,e,i,r){let a=JSON.parse(JSON.stringify(this.productsBundle));const d=t.closest(".x-product-bundle-data").querySelector(".product-name").textContent,n=JSON.parse(t.closest(".x-product-bundle-data").querySelector(".current-variant").textContent),o=!r&&JSON.parse(t.closest(".x-product-bundle-data").querySelector(".current-price").textContent),s=n.featured_image?n.featured_image.src:t.closest(".x-product-bundle-data").querySelector(".featured-image").textContent;let u=r?n.id:n,c=[];c=[...a,r?{...n,title:n.title.replaceAll("\\",""),product_id:e,product_name:d,productUrl:`${i}?variant=${n.id}`,featured_image:s,quantity:1}:{id:u,product_id:e,product_name:d,productUrl:i,featured_image:s,quantity:1,price:o}],this.productsBundle=c,this.errorMessage=!1,this.updateBundleContent(c)},handleAddToCart(e){let i=JSON.parse(JSON.stringify(this.productsBundle));i=i.reduce(((t,e)=>(t[e.id]?t[e.id].quantity+=e.quantity:t[e.id]=e,t)),{}),this.loading=!0,fetch(window.Shopify.routes.root+"cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:i,sections:Alpine.store("xCartHelper").getSectionsToRender().map((t=>t.id))})}).then((t=>t.json())).then((r=>{if(document.dispatchEvent(new CustomEvent(`eurus:product-bundle:products-changed-${t}`,{detail:{productsBundle:Object.values(i),el:e.closest(".product-bundler-wrapper")}})),"422"==r.status){const t=e.closest(".bundler-sticky").querySelector(".cart-warning");return this.errorMessage=!0,void(t&&(t.textContent=r.description))}this.errorMessage=!1,Alpine.store("xCartHelper").getSectionsToRender().forEach((t=>{const e=document.querySelector(t.selector);e&&r.sections[t.id]&&(e.innerHTML=getSectionInnerHTML(r.sections[t.id],t.selector))})),Alpine.store("xQuickView")&&Alpine.store("xQuickView").show&&(Alpine.store("xQuickView").show=!1),Alpine.store("xPopup").open=!1,Alpine.store("xMiniCart").openCart(),Alpine.store("xCartHelper").currentItemCount=parseInt(document.querySelector("#cart-icon-bubble span").innerHTML),document.dispatchEvent(new CustomEvent("eurus:cart:items-changed"))})).catch((t=>{console.error("Error:",t)})).finally((()=>{this.loading=!1,this.productsBundle=[],this.totalPrice=0,this.addToCartButton.setAttribute("disabled","disabled")}))},updateBundleContent(t){let n=t.map((t=>t.price)).reduce(((t,e)=>t+e),0);if(t.length>=e){this.addToCartButton.removeAttribute("disabled");let e=0,o=0;if(Number.isNaN(a))this.totalDiscount=0,this.amountPrice=0;else if(e=Number(a),"percentage"==r&&Number.isInteger(e)&&e>0&&e<100&&(o=Math.ceil(n-n*e/100)),"amount"==r&&e>0&&(e=Number.parseFloat(a).toFixed(2),o=d?n-e*Shopify.currency.rate*100:n-t.length*e*Shopify.currency.rate*100),o>0){this.totalDiscount=this.formatMoney(o,i);let t=n-o;this.amountPrice="-"+this.formatMoney(t,i)}}else this.totalDiscount=0,this.addToCartButton.setAttribute("disabled","disabled");this.totalPrice=this.formatMoney(n,i)},removeBundle(e,i){let r=this.productsBundle[i],a=this.productsBundle.filter(((t,e)=>e!=i));this.productsBundle=a,this.updateBundleContent(a),document.dispatchEvent(new CustomEvent(`eurus:product-bundle:remove-item-${t}`,{detail:{item:r,el:e}}))},formatWithDelimiters(t,e,i,r){if(e=this.defaultOption(e,2),i=this.defaultOption(i,","),r=this.defaultOption(r,"."),isNaN(t)||null==t)return 0;var a=(t=(t/100).toFixed(e)).split(".");return a[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+i)+(a[1]?r+a[1]:"")},defaultOption:(t,e)=>void 0===t?e:t,formatMoney(t,e){var i=/\{\{\s*(\w+)\s*\}\}/;switch(e.match(i)[1]){case"amount":value=this.formatWithDelimiters(t,2);break;case"amount_no_decimals":value=this.formatWithDelimiters(t,0);break;case"amount_with_comma_separator":value=this.formatWithDelimiters(t,2,".",",");break;case"amount_no_decimals_with_comma_separator":value=this.formatWithDelimiters(t,0,".",",")}return e.replace(i,value)}}))),Alpine.data("xProductItemBundle",((t,e,i,r,a,d,n)=>({dataVariant:[],currentVariant:"",isSelect:!1,productId:a,productUrl:r,init(){let e=this.$el.querySelector('[type="application/json"]');if(e){let t=JSON.parse(e.textContent);t=t?.map((t=>({disable:!1,id:t.id}))),this.dataVariant=t}d&&document.addEventListener(`eurus:product-card-variant-select:updated:${t}`,(t=>{this.currentVariant=t.detail.currentVariant,this.options=t.detail.options,this.renderAddToBundleButton(),this.checkVariantSelected(),this.currentVariant&&this.currentVariant.id&&(this.productUrl=r+`/?variant=${this.currentVariant.id}`)})),document.addEventListener(`eurus:product-bundle:products-changed-${i}`,(e=>{e.detail.productsBundle.map((e=>{if(d&&e.product_id==this.productId&&this.currentVariant.available){let e=document.querySelector("#x-atc-button-"+t);e&&e.removeAttribute("disabled")}else if(e.product_id==this.productId){let e=document.querySelector("#x-atc-button-"+t);e&&e.removeAttribute("disabled")}})),n&&this.setUnSelectVariant()})),document.addEventListener(`eurus:product-bundle:remove-item-${i}`,(e=>{if(this.isSelect&&e.detail.item.product_id==this.productId&&d){if(this.currentVariant&&this.currentVariant.available){let e=document.querySelector("#x-atc-button-"+t);e&&e.removeAttribute("disabled")}this.setUnSelectVariant(e.detail.item)}else if(e.detail.item.product_id==this.productId){let i=document.querySelector("#x-atc-button-"+t);if(i&&i.removeAttribute("disabled"),n){document.querySelector("#bundle-product-"+e.detail.item.product_id).classList.remove("cursor-pointer","pointer-events-none","opacity-70")}}}))},setVariantSelected(t){if(this.currentVariant&&-1!=this.dataVariant.findIndex((t=>t.id==this.currentVariant.id&&t.disable))){t.closest(".bundle-product").querySelector(".x-atb-button").setAttribute("disabled","disabled")}},setDisableSelectProduct(t){if(n){let e=JSON.parse(JSON.stringify(this.dataVariant)).map((t=>t.id==this.currentVariant.id?{id:t.id,disable:!0}:{id:t.id,disable:t.disable}));this.dataVariant=e,t.closest(".bundle-product").querySelector(".x-atb-button").setAttribute("disabled","disabled")}},setUnSelectVariant(t){let e="";e=t?JSON.parse(JSON.stringify(this.dataVariant)).map((e=>e.id==t.id?{id:e.id,disable:!1}:{id:e.id,disable:e.disable})):JSON.parse(JSON.stringify(this.dataVariant)).map((t=>({id:t.id,disable:!1}))),this.dataVariant=e},renderAddToBundleButton(){const i=document.getElementById("x-atc-button-"+t);if(i&&this.currentVariant&&this.currentVariant.available){i.removeAttribute("disabled");const t=i.querySelector(".x-atc-text");t&&(t.textContent=e)}},checkVariantSelected(){"-1"==[...document.querySelectorAll(`#variant-update-${t} fieldset`)].findIndex((t=>!t.querySelector("input:checked")))&&(this.isSelect=!0)}})))}))})));
