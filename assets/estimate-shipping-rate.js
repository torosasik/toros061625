window.Eurus.loadedScript.includes("estimate-shipping-rate.js")||(window.Eurus.loadedScript.push("estimate-shipping-rate.js"),requestAnimationFrame((()=>{document.addEventListener("alpine:init",(()=>{Alpine.data("xEstimateShipping",((e,t,s,i)=>({countryEl:e.querySelector(".country-select"),provinceEl:e.querySelector(".province-select"),provinceContainer:e.querySelector(".province-container"),zip:e.querySelector(".zip-input"),rates:e.querySelector(".rates"),errors:e.querySelector(".errors"),loadingShipping:!1,rates_heading:"",rates_text:"",errors_message:"",cachedData:[],cachedResponse:[],load(){this.setSelectedOption(this.countryEl,this.countryEl.dataset.default),this.provinceEl.dataset.default&&this.provinceEl.options.length>0&&this.setSelectedOption(this.provinceEl,this.provinceEl.dataset.default),this.handleCountryChange(),this.countryEl.addEventListener("change",this.handleCountryChange.bind(this))},handleCountryChange(){const e=this.countryEl.options[this.countryEl.selectedIndex],t=JSON.parse(e.dataset.provinces);Array.from(this.provinceEl.options).forEach((e=>e.remove())),t&&0===t.length?this.provinceContainer.hidden=!0:(t.forEach((e=>{const t=document.createElement("option");[t.value,t.innerHTML]=e,this.provinceEl.appendChild(t)})),this.provinceContainer.hidden=!1)},setSelectedOption(e,t){Array.from(e.options).forEach(((s,i)=>{s.value!==t&&s.innerHTML!==t||(e.selectedIndex=i)}))},async submit(e){e.preventDefault(),this.errors.classList.add("hidden"),this.rates.classList.add("hidden");const t=`shipping_address[zip]=${this.zip.value}&shipping_address[country]=${this.countryEl.value}&shipping_address[province]=${this.provinceEl.value}`;if(this.cachedData[t])return this.cachedResponse[t]?this.showRates(this.cachedData[t]):this.showErrors(this.cachedData[t]),!0;this.loadingShipping=!0;try{const e=await fetch(`${Shopify.routes.root}cart/shipping_rates.json?${t}`),s=await e.json();e.ok?this.showRates(s):this.showErrors(s),this.cachedResponse[t]=e.ok,this.cachedData[t]=s}catch(e){console.log(e)}finally{this.loadingShipping=!1}},showRates(e){const r=this.rates.querySelector(".rates-heading");if(e.shipping_rates&&e.shipping_rates.length){this.rates_heading=1===e.shipping_rates.length?t:s;let i="";e.shipping_rates.forEach((e=>{const t=e.price+e.currency;i+=`<li class="pt-2">${e.name}: ${t}</li>`})),r.classList.remove("hidden"),this.rates_text=`<ul class="list-disc pl-4">${i}</ul>`}else r.classList.add("hidden"),this.rates_text=`<p class="no-rate">${i}</p>`;this.rates.classList.remove("hidden")},showErrors(e){let t="";Object.keys(e).forEach((s=>{t+=`<li>${e[s]}</li>`})),this.errors_message=`<ul>${t}</ul>`,this.errors.classList.remove("hidden")}}))),Alpine.store("xPopupShipping",{open:!1})}))})));
